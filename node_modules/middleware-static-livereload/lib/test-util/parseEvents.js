"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseEvents = exports.parseEventLines = exports.parseEventLine = void 0;
const splitString_1 = require("./splitString");
const parseEventLine = (eventLine, keyValueSeparator) => {
    const result = splitString_1.splitString(eventLine, keyValueSeparator).next();
    if (!result.done) {
        const splitResult = result.value;
        const key = splitResult.value.trim();
        if (key) {
            const value = eventLine.slice(splitResult.next).trim();
            if (value) {
                return [key, value];
            }
        }
    }
    return null;
};
exports.parseEventLine = parseEventLine;
const parseEventLines = function* (eventLines, lineBreak, keyValueSeparator) {
    for (const eventLine of splitString_1.splitString(eventLines, lineBreak)) {
        const pair = exports.parseEventLine(eventLine.value, keyValueSeparator);
        if (pair) {
            yield pair;
        }
    }
};
exports.parseEventLines = parseEventLines;
const parseEvents = function* (receivedMessage, lineBreak = '\n', eventSeparator = `${lineBreak}${lineBreak}`, keyValueSeparator = ':') {
    for (const eventLines of splitString_1.splitString(receivedMessage, eventSeparator)) {
        const event = {};
        for (const [key, value] of exports.parseEventLines(eventLines.value, lineBreak, keyValueSeparator)) {
            event[key] = value;
        }
        yield event;
    }
};
exports.parseEvents = parseEvents;
